#
#  ESP32 Built-in CAN (TWAI) Configuration
#  For ESP32-S3 and other variants with integrated CAN controller
#

#########################################
#                                       #
#   CAN BUS (Built-in TWAI)            #
#                                       #
#########################################
canbus:
  - platform: esp32_can
    id: my_can
    tx_pin: ${can_tx_pin}
    rx_pin: ${can_rx_pin}
    can_id: ${can_id_pc}
    use_extended_id: false
    # changed the standard bit_rate of 20kbps to 50kbps due to the clamp usage recommendation on the wpm4 (X1.2 and X1.18) by the manufactorer
    bit_rate: 50kbps 
    # Increased buffer sizes to prevent overflows
    # ESP32-S3 has much larger buffers than MCP2515 (2 RX buffers)
    rx_queue_len: 256  # Default: 8, increased for high-traffic CAN bus
    tx_queue_len: 64   # Default: 16, increased for burst writes
    on_frame:
      - can_id: 0
        can_id_mask: 0
        then:
          - lambda: |-
              processAndUpdate(can_id, x);
